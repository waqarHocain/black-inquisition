<%- include("./partials/header", {title: "Create Account"}) %>

<section class="py-12 bg-gray-50 sm:py-16">
  <div class="text-center mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h1 class="text-4xl font-bold text-gray-900 sm:text-5xl lg:text-6xl">
      Registration
    </h1>
    <p class="mt-3 text-lg text-gray-600">Create an account to get started</p>

    <form method="POST" id="signupForm" class="max-w-sm mx-auto mt-8">
      <label class="block">
        <span class="block text-xs font-medium text-gray-500 text-left">
          Full Name:
        </span>
        <input
          type="text"
          name="fullname"
          class="w-full p-3 mt-1 text-sm input-primary"
          value="<%= (locals.formData && locals.formData.fullname) ? locals.formData.fullname : '' %>"
          required
        />
        <small class="block text-left text-red-600">
          <% if (locals.errors && locals.errors.fullname) { %> <%=
          locals.errors.fullname %> <% } %>
        </small>
      </label>

      <label class="block mt-6">
        <span class="block text-xs font-medium text-gray-500 text-left"
          >Email:</span
        >
        <input
          type="email"
          name="email"
          class="w-full p-3 mt-1 text-sm input-primary"
          value="<%= (locals.formData && locals.formData.email) ? locals.formData.email : '' %>"
          required
        />
        <small class="block text-left text-red-600">
          <% if (locals.errors && locals.errors.email) { %> <%=
          locals.errors.email %> <% } %>
        </small>
      </label>

      <label class="block mt-6">
        <span class="block text-xs font-medium text-gray-500 text-left">
          Password:</span
        >
        <input
          class="w-full p-3 mt-1 text-sm input-primary"
          type="password"
          name="password"
          value="<%= (locals.formData && locals.formData.password) ? locals.formData.password : '' %>"
          required
        />
        <small class="block text-left text-red-600">
          <% if (locals.errors && locals.errors.password) { %> <%=
          locals.errors.password %> <% } %>
        </small>
      </label>

      <label class="block mt-6">
        <span class="block text-xs font-medium text-gray-500 text-left">
          Confirm Password:</span
        >
        <input
          class="w-full p-3 mt-1 text-sm input-primary"
          type="password"
          name="confirmPassword"
          value="<%= (locals.formData && locals.formData.confirmPassword) ? locals.formData.confirmPassword : '' %>"
          required
        />
        <small class="block text-left text-red-600">
          <% if (locals.errors && locals.errors.confirmPassword) { %> <%=
          locals.errors.confirmPassword %> <% } %></small
        >
      </label>

      <label class="block mt-6">
        <span class="block text-xs font-medium text-gray-500 text-left">
          Bio (brief description of your work):</span
        >
        <textarea
          class="w-full h-[150px] p-3 mt-1 text-sm input-primary"
          name="bio"
          required
        >
<%= (locals.formData && locals.formData.bio) ? locals.formData.bio : '' %></textarea
        >
        <small class="block text-left text-red-600">
          <% if (locals.errors && locals.errors.bio) { %> <%= locals.errors.bio
          %> <% } %>
        </small>
      </label>

      <button type="submit" class="btn-primary px-5 py-2 block mt-6">
        Create Account
      </button>
    </form>

    <p class="mt-9">
      Already have an account?
      <a class="underline font-bold" href="/auth/login">Login </a>
    </p>
  </div>
</section>

<script>
  const form = document.getElementById("signupForm");

  function clearErrMsgs() {
    const msgContainers = document.querySelectorAll("label small");
    console.log(msgContainers);
    msgContainers.forEach((el) => (el.innerHTML = ""));
  }

  function showErrorMsg(msg, inputField) {
    const msgContainer = inputField.parentNode.querySelector("small");
    msgContainer.innerText = msg;
  }

  function validateEmail(email) {
    return String(email)
      .toLowerCase()
      .match(
        /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
      );
  }

  function handleSubmit(e) {
    e.preventDefault();
    // clear previous error messages
    clearErrMsgs();

    let isError = false; // prevent form submition if there's an error

    const nameField = form.elements["fullname"];
    const emailField = form.elements["email"];
    const passwordField = form.elements["password"];
    const confirmPasswordField = form.elements["confirmPassword"];
    const bioField = form.elements["bio"];

    const name = nameField.value;
    const email = emailField.value;
    const password = passwordField.value;
    const confirmPassword = confirmPasswordField.value;
    const bio = bioField.value;

    if (name.length < 4) {
      showErrorMsg("Name must be 4 or more characters long", nameField);
      isError = true;
    }

    if (password !== confirmPassword) {
      showErrorMsg("Passwords don't match.", confirmPasswordField);
      isError = true;
    }

    if (!validateEmail(email)) {
      showErrorMsg("Please enter a valid email address", emailField);
      isError = true;
    }

    if (password.length < 8) {
      showErrorMsg(
        "Passwords must be 8 or more characters long",
        passwordField
      );
      isError = true;
    }

    if (bio.length < 20) {
      showErrorMsg("Bio must be 20 or more characters long", bioField);
      isError = true;
    }

    if (!isError) {
      form.submit();
    }
  }

  form.addEventListener("submit", handleSubmit);
</script>

<%- include("./partials/footer") %>
