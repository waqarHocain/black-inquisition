<%- include("./partials/header", {title: "Profile"}) %>

<section class="py-12 sm:py-16">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div
      class="flex flex-col items-center gap-y-4 sm:flex-row sm:gap-x-3 bg-gray-800 border-[1px] border-gray-700 rounded p-4"
    >
      <img
        src="<%= user.photo %>"
        alt="Your profile picture"
        class="rounded-full w-20 h-20 sm:w-12 sm:h-12 inline ring-4"
      />
      <div>
        <h1 class="text-white text-3xl font-semibold"><%= user.name %></h1>
      </div>
    </div>

    <div
      class="flex flex-col gap-4 sm:flex-row sm:gap-12 text-gray-50 bg-gray-800 border-[1px] border-gray-700 border-t-0 rounded p-4"
    >
      <div class="sm:border-r-2 border-gray-500 sm:pr-4">
        <h4 class="text-sm text-gray-300">Email:</h4>
        <p><%= user.email %></p>
      </div>

      <div class="sm:border-r-2 border-gray-500 sm:pr-4">
        <h4 class="text-sm text-gray-300">Joined:</h4>
        <p><%= user.createdAt.toDateString() %></p>
      </div>

      <div>
        <h4 class="text-sm text-gray-300">Account Status:</h4>
        <p><%= user.verified ? "Approved" : "Pending" %></p>
      </div>

      <% if (locals.userId) { %> <% if (isFriend) { %>
      <div class="sm:border-l-2 border-gray-500 sm:pl-4">
        <button
          class="inline-flex items-center btn-primary border-white border-[1px] text-sm rounded px-3 py-1 mr-2 opacity-75 bg-transparent pointer-events-none"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-4 h-4 mr-2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
            />
          </svg>

          <span class="">Friend</span>
        </button>
      </div>
      <% } else if (hasSentRequest) { %>
      <div class="sm:border-l-2 border-gray-500 sm:pl-4">
        <button
          class="inline-flex items-center bg-blue-400 btn-primary text-sm rounded px-3 py-1 mr-2 opacity-75 pointer-events-none"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="lime"
            class="w-4 h-4 mr-2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
          <span>Request Sent</span>
        </button>
      </div>
      <% } else { %>
      <div class="sm:border-l-2 border-gray-500 sm:pl-4">
        <button class="btn-primary px-2 py-1 rounded">Add Friend</button>
      </div>
      <% } %><% } %>
    </div>

    <div
      class="bg-gray-800 border-[1px] border-gray-700 rounded p-4 mt-8 text-gray-100"
    >
      <h3
        class="font-semibold border-b-[1px] border-gray-500 pb-2 text-gray-300"
      >
        About
      </h3>
      <p class="pt-3 max-w-3xl"><%= user.bio %></p>
    </div>

    <div
      class="bg-gray-800 border-[1px] border-gray-700 rounded p-4 mt-8 text-gray-100"
    >
      <h3 class="font-semibold border-b-[1px] border-gray-500 pb-2">
        Public Data
      </h3>

      <div class="bg-gray-800 border-[1px] border-gray-700 rounded-md p-4 mt-8">
        <h3 class="font-semibold border-b-[1px] border-gray-500 pb-2">
          Recently Posted Jobs
        </h3>

        <% if (recentJobs.length > 0) { %>
        <div class="overflow-x-auto mt-2">
          <table class="min-w-full divide-y-2 divide-gray-400 text-sm">
            <thead>
              <tr class="text-left">
                <th
                  class="whitespace-nowrap px-4 py-2 font-semibold text-gray-100"
                >
                  #
                </th>

                <th
                  class="whitespace-nowrap px-4 py-2 font-semibold text-gray-100"
                >
                  Title
                </th>

                <th
                  class="whitespace-nowrap px-4 py-2 font-semibold text-gray-100"
                >
                  Location
                </th>

                <th
                  class="whitespace-nowrap px-4 py-2 font-semibold text-gray-100"
                >
                  Type
                </th>

                <th
                  class="whitespace-nowrap px-4 py-2 font-semibold text-gray-100"
                >
                  Workplace
                </th>

                <th
                  class="whitespace-nowrap px-4 py-2 font-semibold text-gray-100"
                >
                  Company
                </th>

                <th class="px-4 py-2"></th>
              </tr>
            </thead>

            <tbody class="divide-y divide-gray-400">
              <% recentJobs.forEach((job, index) => { %>
              <tr class="text-left">
                <td class="whitespace-nowrap px-4 py-2 text-gray-300">
                  <%= index + 1 %>
                </td>

                <td class="whitespace-nowrap px-4 py-2 text-gray-300">
                  <a href="/jobs/<%= job.id %>"> <%= job.title %> </a>
                </td>

                <td class="whitespace-nowrap px-4 py-2 text-gray-300">
                  <%= job.location %>
                </td>

                <td class="whitespace-nowrap px-4 py-2 text-gray-300">
                  <%= job.type == "partTime" ? "Part-time" : job.type ==
                  "fullTime" ? "Full-time" : job.type %>
                </td>

                <td class="whitespace-nowrap px-4 py-2 text-gray-300">
                  <%= job.workplace == "onSite" ? "on-site" : job.workplace %>
                </td>

                <td class="whitespace-nowrap px-4 py-2 text-gray-300">
                  <%= job.company %>
                </td>

                <td class="whitespace-nowrap px-4 py-2">
                  <a
                    href="/jobs/<%= job.id %>"
                    class="btn-primary inline-block px-4 py-1 text-xs font-medium rounded-md"
                    >View</a
                  >
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
        <% } else { %>
        <p class="mt-3 text-gray-300">This user hasn't posted any jobs.</p>
        <% } %>
      </div>

      <div class="bg-gray-800 border-[1px] border-gray-700 rounded-md p-4 mt-8">
        <h3 class="font-semibold border-b-[1px] border-gray-500 pb-2">
          Recent Blog Posts
        </h3>

        <% if (posts.length > 0) { %> <% posts.forEach(post => { %>

        <h3><%= post.title %></h3>

        <% }) %> <% } else { %>
        <p class="mt-3 text-gray-300">No posts found.</p>
        <% } %>
      </div>
    </div>
  </div>
</section>

<%- include("./partials/footer") %>
